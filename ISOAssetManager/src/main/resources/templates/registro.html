<!DOCTYPE html>
<!-- Namespace de Thymeleaf -->
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Registro - ISOAssetManager</title>
    <link rel="stylesheet" href="/registroestilos.css">
</head>

<body>
    <div class="registro-container">
        <h2>Registro de Usuario</h2>

        <!-- Formulario de registro de nuevos usuarios -->
        <form th:action="@{/registro}" method="post">
            <!-- Protección CSRF -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <!-- Nombre completo -->
            <div class="form-group">
                <label for="nombre">Nombre</label>
                <input type="text" id="nombre" name="nombre" required>
            </div>

            <!-- Email único de registro -->
            <div class="form-group">
                <label for="email">Correo electrónico</label>
                <input type="email" id="email" name="email" required>
            </div>

            <!-- Contraseña -->
            <div class="form-group">
                <label for="password">Contraseña</label>
                <input type="password" id="password" name="password" required>

                <!-- Requisitos de contraseña (sin estilos ni scripts) -->
                <div>
                    <p>
                        La contraseña debe tener entre <strong>8 y 32</strong> caracteres y cumplir
                        <strong>al menos 3 de estos 4 criterios</strong>:
                    </p>
                    <ul>
                        <li>Mayúsculas (A-Z)</li>
                        <li>Minúsculas (a-z)</li>
                        <li>Números (0-9)</li>
                        <li>Caracteres especiales (!,@,#,$,%,...)</li>
                    </ul>
                    <p>
                        No se permiten más de <strong>2 caracteres iguales consecutivos</strong>.
                    </p>
                </div>
            </div>

            <!-- Botones -->
            <button type="submit">Registrarse</button>
            <a href="/login" class="btn-secondary">Iniciar sesión</a>
        </form>

        <!-- Mensaje de error general si falla el registro -->
        <div th:if="${error}">
            <p th:text="${error}"></p>
        </div>
    </div>

    <!-- DIV opcional que el servidor puede rellenar si hay mensaje tras subir evidencia -->
    <div th:if="${uploadMessage}" id="upload-status" th:data-message="${uploadMessage}" th:data-type="${uploadType}">
    </div>

    <!-- Toast global reutilizable -->
    <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true" hidden></div>

    <script>
        // Mostrar toast con mensaje y tipo ('success'|'error'|'info')
        function showToast(message, type = 'success', duration = 4000) {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = message;
            toast.className = 'toast ' + (type === 'error' ? 'toast--error' : type === 'info' ? 'toast--info' : 'toast--success');
            toast.hidden = false;
            // for accessibility: move focus briefly (optional)
            toast.setAttribute('tabindex', '-1');
            toast.focus({ preventScroll: true });
            setTimeout(() => {
                toast.classList.add('toast--visible');
            }, 10);
            setTimeout(() => {
                toast.classList.remove('toast--visible');
                setTimeout(() => { toast.hidden = true; }, 300);
            }, duration);
        }

        // Si el servidor inyectó un mensaje (Thymeleaf), mostrarlo al cargar
        document.addEventListener('DOMContentLoaded', function () {
            const statusEl = document.getElementById('upload-status');
            if (statusEl) {
                const msg = statusEl.getAttribute('data-message');
                const type = statusEl.getAttribute('data-type') || 'success';
                if (msg) showToast(msg, type);
            }

            // Ejemplo: si necesitas mostrar toast al enviar formularios via JS,
            // llama showToast('Evidencia subida correctamente', 'success');
        });
    </script>
</body>

</html>